/*
 * SunEdison.com Leaderboard plugin for jQuery
 *
 */
(function($){
   $.fn.extend({
     leaderboard: function(url) {
      var container = this.eq(0);
      if ( !container.length || !url ) { return }

      var options = {};

      $.ajax({
         url: url,
         type: 'GET',
         dataType: 'text',
         success: function (data, textStatus) { boardStart( jQuery.parseJSON( data ) ) }
      });


      var boardStart = function( options ) {
         container.html('SunEdison Electricity Generated:');
         container.addClass('started');

         span_kwh = '<span class="kwh"><b></b> kWh</span>'
         span_lbs = '<span class="lbs">CO2 Offset: <b></b> lbs</span>'
         container.append( span_kwh + span_lbs );

         container_kwh = container.find(".kwh b");
         container_lbs = container.find(".lbs b");

         var format = function(string) {
           string += '';
           x = string.split('.');
           x1 = x[0];
           x2 = x.length > 1 ? '.' + x[1] : '';
           var rgx = /(\d+)(\d{3})/;
           while (rgx.test(x1)) {
             x1 = x1.replace(rgx, '$1' + ',' + '$2');
           }
           return x1 + x2;
         };

         var i = 1;

         var go = function() {
           kwh = options.power + ( options.persecond * i );
           lbs = kwh * options.co2offset;
           container_kwh.text( format( kwh.toFixed(0) ) );
           container_lbs.text( format( lbs.toFixed(0) ) );
           i++;
         };
         go();
         window.setInterval( go, 1000 );
       }
     }
   });
})(jQuery);
